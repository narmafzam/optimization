<?php
 namespace Optimization\Critical\CSS; use Boilerplate\DOMCrawler; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\ThemeUtil; use Boilerplate\Util\UserUtil; class CSS extends Common { const CRITICAL_CSS_GENERATION_ = "\x6f\160\164\x69\x6d\x69\172\x61\x74\x69\157\x6e\137\x63\x72\151\164\151\x63\x61\x6c\x5f\x63\x73\x73\137\x67\145\156\145\162\141\164\x69\157\x6e\137"; const RUNNING_PROCESS_TRANSITION = self::CRITICAL_CSS_GENERATION_ . "\160\162\157\143\145\163\163\137\162\x75\156\x6e\x69\156\x67"; const CRITICAL_CSS_GENERATION_DONE = self::CRITICAL_CSS_GENERATION_ . "\144\157\156\145"; public function __construct() { $this->loadRequirement(); parent::__construct(); } public function addActions() : self { $this->addAction("\157\160\164\x69\x6d\151\x7a\x61\x74\x69\157\x6e\137\142\165\x66\146\145\162\x5f\160\x72\x6f\x63\x65\163\x73", [$this, "\145\170\164\x72\141\x63\x74\103\x72\x69\164\151\143\x61\154"]); return parent::addActions(); } public function addFilters() : self { $this->addFilter("\144\x6f\x5f\143\x61\143\150\x65\x5f\x67\145\x6e\145\162\x61\x74\x65\x5f\x63\141\143\150\151\156\147\137\146\151\154\145\x73", [$this, "\x69\x73\117\160\164\x69\x6d\x69\172\x65\144"], 0)->addFilter("\x6f\160\x74\x69\155\x69\172\141\x74\x69\157\156\x5f\151\x73\x5f\x6f\x70\164\x69\155\151\x7a\145\x64", [$this, "\x69\163\x4f\x70\164\x69\155\x69\x7a\145\x64"], 1, 0)->addFilter("\143\x73\x73\137\x61\163\163\145\x74\137\165\162\x6c", [$this, "\x6d\x61\171\142\145\x44\151\163\141\x62\154\x65\x48\145\141\x64\103\x73\163\106\151\154\x65"], 1, 999)->addFilter("\142\x6f\x69\154\x65\x72\x70\x6c\x61\x74\145\x5f\141\x73\x73\x65\164\137\x69\156\x6c\x69\x6e\x65\x5f\x73\164\171\154\145\163", [$this, "\141\144\144\123\x74\x79\x6c\145\x54\x6f\x48\x65\x61\144"], 1, 99)->addFilter("\157\x70\x74\151\x6d\151\x7a\x61\x74\x69\157\156\137\143\162\151\164\x69\x63\x61\x6c\137\143\x73\x73\x5f\x69\163\137\157\x70\164\151\x6d\x69\172\145\144", [$this, "\x69\163\x4f\160\164\151\155\151\x7a\145\144"], 1, 0)->addFilter("\x74\150\145\155\x65\x5f\x66\x6f\x6f\x74\145\162\x5f\x6c\x6f\141\x64\137\x6a\163\x5f\x6c\157\x61\144\145\162\137\167\x69\x74\150\137\x65\x76\145\156\164", [$this, "\x69\163\117\x70\164\151\155\151\x7a\145\x64"], 1, 0); return parent::addFilters(); } public function isOptimized($optimized = true) { goto EMXKR; h3k_k: return $optimized; goto agiyM; jdrOh: $optimized = !UserUtil::isUserLoggedIn() && $this->getFilesystem()->exists(Util::getFullName()); goto lOJKs; EMXKR: if ($optimized) { goto v_MbP; } goto jdrOh; lOJKs: v_MbP: goto h3k_k; agiyM: } public function maybeDisableHeadCssFile($url) { goto vKBMx; BTAam: Tj6KH: goto XlS3d; Sk3wX: $fullName = Util::getFullName(); goto m3YvG; swxwq: if (!trim($content)) { goto hfy9b; } goto qzLzy; HIjIk: hfy9b: goto BTAam; qzLzy: $url = ''; goto HIjIk; XlS3d: return $url; goto FUP2Q; m3YvG: $content = $this->getFilesystem()->getContent($fullName); goto swxwq; vKBMx: if (!$this->isOptimized(false)) { goto Tj6KH; } goto Sk3wX; FUP2Q: } public function addStyleToHead($styles) { goto ADPPK; nWEA0: $fullName = Util::isGenerated(); goto OaAdR; m5_JS: return $styles; goto rTQuD; XjbHS: lsvOi: goto fmjrX; OaAdR: $content = $this->getFilesystem()->getContent($fullName); goto pct6R; ADPPK: if (!$this->isOptimized(false)) { goto i2rFM; } goto nWEA0; fmjrX: i2rFM: goto m5_JS; ttUCE: $styles .= $content; goto XjbHS; pct6R: if (!is_string($content)) { goto lsvOi; } goto ttUCE; rTQuD: } public function loadRequirement() { Purge::getInstance(); Extractor::getInstance(); } public function extractCritical(?string $buffer) { goto mesXS; eDInw: nxsdD: goto VMUN_; fSloN: return $buffer; goto DtbB1; yc27T: $buffer = DOMCrawler::addChild($buffer, "\150\x65\x61\x64", $critical); goto nZHE7; PNrO0: if (!DOMCrawler::has($buffer, $selector)) { goto SyFLk; } goto ZUwwf; nZHE7: BLDnn: goto eDInw; tppeX: y8ldu: goto fSloN; Ffq2R: SyFLk: goto vieK8; mesXS: if (!$this->applyFilters("\157\x70\x74\151\x6d\151\x7a\x61\164\x69\157\x6e\137\143\x72\151\164\x69\x63\x61\154\137\143\x73\x73\137\143\x61\x6e\x5f\x65\170\164\x72\x61\x63\x74", true)) { goto y8ldu; } goto ydK9U; ZUwwf: $buffer = DOMCrawler::updateContent($buffer, $selector, $critical); goto Z2qlI; vieK8: $critical = ThemeUtil::generateElement("\x73\164\171\x6c\x65", [], true, $critical); goto yc27T; IwWwY: $selector = "\x73\x74\171\154\145\x23\x62\157\x69\154\x65\x72\x70\x6c\x61\x74\145\137\x69\156\154\x69\156\x65\x5f\x73\x74\x79\x6c\145"; goto PNrO0; VMUN_: GqNv9: goto tppeX; C_jZt: if (!$critical) { goto nxsdD; } goto IwWwY; pwgnL: $critical = Extractor::getInstance()->extract($buffer, $fullName, true); goto C_jZt; ydK9U: if (!($fullName = Util::isNotGenerated())) { goto GqNv9; } goto pwgnL; Z2qlI: goto BLDnn; goto Ffq2R; DtbB1: } }
