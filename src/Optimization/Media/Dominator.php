<?php
 namespace Optimization\Media; use Boilerplate\Form\Form; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\PostUtil; use Boilerplate\Util\ThemeUtil; use ColorThief\ColorThief; use Exception; class Dominator extends Common { const DOMINATE_HEX_META = "\144\157\155\x69\x6e\x61\x74\x65\x5f\150\145\170"; const DOMINATE_OVERRIDE_META = "\144\x6f\x6d\151\x6e\x61\x74\145\x5f\x6f\166\x65\x72\162\151\144\145"; const DOMINATE_PLATTE_HEX_META = "\x63\157\x6c\x6f\x72\137\x70\x6c\x61\164\x74\x65\x5f\150\145\x78"; public function __construct() { goto OkNag; tYWQd: parent::__construct(); goto e7oz2; e7oz2: wSawH: goto afdfV; OkNag: if (!extension_loaded("\x47\x44")) { goto wSawH; } goto tYWQd; afdfV: } public function addActions() : self { $this->addAction("\141\x64\144\137\x61\164\x74\141\x63\150\x6d\x65\156\164", [$this, "\165\x70\144\x61\164\145\x43\x6f\154\157\x72\x44\157\155\151\x6e\x61\156\x63\x65"]); return parent::addActions(); } public function addFilters() : self { $this->addFilter("\x61\x74\164\141\x63\x68\x6d\x65\x6e\x74\x5f\x66\151\145\154\144\163\x5f\164\x6f\137\x73\141\x76\x65", [$this, "\163\141\166\145\106\151\145\x6c\x64"])->addFilter("\x61\x74\x74\x61\x63\x68\155\145\156\x74\137\146\x69\x65\x6c\x64\x73\x5f\164\157\x5f\x65\144\x69\164", [$this, "\141\x64\x64\106\151\x65\154\x64"], 3)->addFilter("\157\x70\164\151\x6d\151\172\141\x74\x69\157\x6e\137\155\x65\x64\x69\x61\x5f\154\x61\x7a\171\x5f\x6c\x6f\x61\144\x5f\160\x6c\141\x63\145\x68\157\x6c\144\x65\162", [$this, "\x67\145\164\120\x6c\141\x63\x65\150\157\x6c\144\145\162"], 3, 99); return parent::addFilters(); } public function getPlaceholder($qLxZn, $KcXuZ = null, $CArB4 = array()) { goto rhLVv; Mag9H: $GvXzJ = str_replace("\x23", '', $GvXzJ); goto g1pwO; GzR5E: if ($eQ9Gc) { goto FRdGa; } goto dMEw2; YlcSI: $eQ9Gc = $FSmib = 100; goto FUmgw; r62dM: FRdGa: goto wLhu5; s0iOC: $eQ9Gc = ArrayUtil::get($CArB4, "\167\151\x64\x74\150"); goto O8IIL; wLhu5: if ($eQ9Gc) { goto F5nMa; } goto YlcSI; dMEw2: $eQ9Gc = ArrayUtil::get($CArB4, "\144\141\x74\x61\x2d\167\151\x64\164\x68"); goto zAN1p; rhLVv: $GvXzJ = $this->srcColor("\x23\x30\x37\x35\x37\71\x38", $KcXuZ); goto s0iOC; FUmgw: F5nMa: goto Mag9H; zAN1p: $FSmib = ArrayUtil::get($CArB4, "\144\141\164\141\55\150\x65\x69\147\x68\164"); goto r62dM; g1pwO: return "\x64\141\x74\141\x3a\151\x6d\x61\147\x65\x2f\163\166\147\53\170\155\154\x3b\143\150\141\162\163\x65\x74\75\125\x54\x46\x2d\70\54\45\63\103\163\x76\147\x25\x32\x30\x78\155\x6c\156\x73\45\63\104\45\62\62\150\x74\x74\160\x25\x33\x41\x25\x32\106\45\x32\106\167\x77\167\x2e\167\x33\56\x6f\162\147\x25\62\x46\x32\60\60\60\x25\62\106\163\x76\x67\x25\x32\x32\45\x32\x30\x77\x69\x64\x74\x68\x25\x33\104\x25\x32\62{$eQ9Gc}\x25\62\62\x25\x32\60\150\145\151\x67\x68\x74\x25\63\x44\x25\62\62{$FSmib}\45\62\x32\45\x32\60\x76\x69\x65\167\102\x6f\170\45\63\x44\x25\62\x32\60\45\62\60\x30\x25\x32\60{$eQ9Gc}\45\x32\x30{$FSmib}\x25\x32\x32\x25\63\105\x25\x33\x43\162\145\143\164\45\62\x30\x66\151\154\154\x25\63\104\x25\62\x32\45\x32\x33{$GvXzJ}\45\62\x32\45\62\x30\x77\x69\144\x74\150\45\x33\x44\x25\62\x32{$eQ9Gc}\45\x32\x32\x25\x32\60\150\145\151\x67\x68\x74\45\63\104\x25\62\x32{$FSmib}\45\62\x32\x25\62\106\45\x33\105\x25\x33\x43\x25\x32\x46\163\166\147\x25\x33\x45"; goto j5i4W; O8IIL: $FSmib = ArrayUtil::get($CArB4, "\x68\145\x69\x67\x68\x74"); goto GzR5E; j5i4W: } public function srcColor($GvXzJ, $post = null) { goto NVUQt; hktti: pQFNB: goto ccr5Y; ZcaqY: $C2GnT = PostUtil::getMeta(self::DOMINATE_HEX_META, true, $KcXuZ); goto bS8aq; mJJPL: goto dJpn5; goto jfsnl; bS8aq: if (!$C2GnT) { goto rUp3V; } goto tKoMG; jfsnl: dqnNF: goto hEz59; hEz59: $KcXuZ = PostUtil::getFeatureImageAttachment($post); goto rbMyZ; jY3HF: $KcXuZ = $post; goto mJJPL; tKoMG: $GvXzJ = $C2GnT; goto I1f5X; hHexW: if (PostUtil::getType($post) !== "\x61\164\164\141\x63\x68\155\145\x6e\164") { goto dqnNF; } goto jY3HF; rbMyZ: dJpn5: goto ZcaqY; BcJpU: if (!$post) { goto pQFNB; } goto hHexW; ccr5Y: return $GvXzJ; goto PEKsX; NVUQt: $post = PostUtil::get($post, PostUtil::OBJECT, true); goto BcJpU; I1f5X: rUp3V: goto hktti; PEKsX: } public function rgb2hex($lh0OS) { goto ROZkE; ROZkE: $C2GnT = "\43"; goto B3uEC; r0gV8: fLiaM: goto B9TrF; B9TrF: return $C2GnT; goto AmSDZ; FfO3z: goto fLiaM; goto Ci0fR; ZJCPt: $C2GnT .= str_pad(dechex($lh0OS[1]), 2, "\x30", STR_PAD_LEFT); goto YEj0U; B3uEC: if (is_array($lh0OS) && count($lh0OS) == 3) { goto FWqn0; } goto MWi_k; s1_p7: $C2GnT .= str_pad(dechex($lh0OS[0]), 2, "\x30", STR_PAD_LEFT); goto ZJCPt; YEj0U: $C2GnT .= str_pad(dechex($lh0OS[2]), 2, "\x30", STR_PAD_LEFT); goto r0gV8; MWi_k: $C2GnT .= "\105\x39\x45\x39\105\71"; goto FfO3z; Ci0fR: FWqn0: goto s1_p7; AmSDZ: } public function updateColorDominance($KcXuZ) { goto Khy_5; FTu4H: fQXMS: goto BXqJN; xjCA_: try { goto i970X; i4w7M: if (!$GvXzJ) { goto gZq8I; } goto Nwrlo; Nwrlo: $C2GnT = $this->rgb2hex($GvXzJ); goto eQXF1; GAYTx: k6L1x: goto Vf7Zr; dtM_M: $h0Nf_ = ColorThief::getPalette($nQqAP, 8); goto HAWr2; HAWr2: $N34ee = []; goto WLLhP; eQXF1: PostUtil::updateMeta(self::DOMINATE_HEX_META, $C2GnT, $KcXuZ); goto dtM_M; o007E: gZq8I: goto MOI4L; i970X: $GvXzJ = ColorThief::getColor($nQqAP); goto i4w7M; Vf7Zr: PostUtil::updateMeta(self::DOMINATE_PLATTE_HEX_META, $N34ee, $KcXuZ); goto o007E; WLLhP: foreach ($h0Nf_ as $lh0OS) { $N34ee[] = $this->rgb2hex($lh0OS); FIJhS: } goto GAYTx; MOI4L: } catch (Exception $Vggs0) { } goto FTu4H; wOhfh: $lzMAN = wp_upload_dir(); goto QPNoM; F1rSw: if (!$nQqAP) { goto fQXMS; } goto xjCA_; Khy_5: if (!wp_attachment_is_image(PostUtil::getId($KcXuZ))) { goto ZxLyJ; } goto wOhfh; BXqJN: ZxLyJ: goto T2vsI; QPNoM: $nQqAP = "{$lzMAN["\142\x61\163\145\144\151\162"]}\x2f" . PostUtil::getMeta("\137\x77\160\137\x61\164\164\141\143\150\x65\x64\137\146\x69\x6c\x65", true, $KcXuZ); goto F1rSw; T2vsI: } public function addField($VQAqe, $KcXuZ) { goto fXcQt; s_77u: $VQAqe[self::DOMINATE_HEX_META] = ["\150\164\x6d\x6c" => Form::getFormElement()->renderFields([Form::getRadioField(self::DOMINATE_HEX_META)->setOptions($hDXmd)->setDefault(PostUtil::getMeta(self::DOMINATE_HEX_META, true, $KcXuZ))->setInline(true)->addParentClass("\144\157\x6d\x69\x6e\141\x6e\164\x2d\143\x6f\x6c\x6f\162\x73")], false), "\x69\156\160\x75\x74" => "\x68\164\155\x6c", "\x6c\x61\142\x65\154" => __("\x44\157\x6d\x69\156\141\156\x74\40\103\x6f\x6c\157\x72", OPTIMIZATION_DOMAIN)]; goto xrzkU; fmwtT: Drpb2: goto MLUIn; TvWfQ: $hDXmd = []; goto O2w3g; Foj8k: j3_3g: goto s_77u; xrzkU: goto vsvtz; goto I8IX9; MLUIn: return $VQAqe; goto Xl2v1; yLFUy: vsvtz: goto fmwtT; fXcQt: if (!$this->notSvg($KcXuZ)) { goto Drpb2; } goto rFk9I; wNy8p: if (!$JZhrh) { goto yixg_; } goto TvWfQ; BH8DH: $VQAqe[self::DOMINATE_OVERRIDE_META] = ["\151\156\160\x75\164" => "\x68\x74\155\154", "\150\x74\x6d\x6c" => Form::getFormElement()->renderFields([Form::getCheckboxField(self::DOMINATE_OVERRIDE_META, __("\116\157\40\103\157\x6c\157\x72\x20\104\157\155\151\156\141\156\143\145\x20\101\166\x61\151\x6c\x61\142\x6c\145\56", OPTIMIZATION_DOMAIN))->setDesc(__("\103\x68\x65\x63\153\x20\x74\x68\151\163\40\x69\x74\145\155\x20\146\157\x72\x20\147\x65\156\145\x72\x61\x74\145\x20\x64\x6f\x6d\151\x6e\x61\x74\145\x20\143\x6f\x6c\x6f\x72\163\x2e", OPTIMIZATION_DOMAIN))], false)]; goto yLFUy; O2w3g: foreach ($JZhrh as $nzF0q => $GvXzJ) { $hDXmd[$GvXzJ] = ThemeUtil::generateElement("\163\x70\141\x6e", ["\x73\x74\171\x6c\x65" => "\x62\141\143\153\147\162\x6f\165\156\x64\x2d\x63\x6f\x6c\157\162\x3a\40{$GvXzJ}\73", "\143\154\141\x73\163" => "\x77\x2d\x31\60\60"], true); QG0DK: } goto Foj8k; rFk9I: $JZhrh = PostUtil::getMeta(self::DOMINATE_PLATTE_HEX_META, true, $KcXuZ); goto wNy8p; I8IX9: yixg_: goto BH8DH; Xl2v1: } public function saveField($KcXuZ) { goto GyQ08; Akbe_: return $KcXuZ; goto YQmNX; M3Y6l: PnQfP: goto AR2AG; Gp59p: if (CommonUtil::getRequest(self::DOMINATE_OVERRIDE_META, false)) { goto PnQfP; } goto KmyWl; QBeRS: goto FF2WG; goto M3Y6l; AR2AG: $this->updateColorDominance($KcXuZ); goto q1pui; GyQ08: if (!$this->notSvg($KcXuZ)) { goto Dpsg4; } goto Gp59p; KmyWl: if ($C2GnT = CommonUtil::getRequest(self::DOMINATE_HEX_META, false)) { goto YbvoL; } goto QBeRS; yRTNL: YbvoL: goto IdBzw; q1pui: goto FF2WG; goto yRTNL; IdBzw: PostUtil::updateMeta(self::DOMINATE_HEX_META, $C2GnT, $KcXuZ); goto Yr6xv; Yr6xv: FF2WG: goto HG068; HG068: Dpsg4: goto Akbe_; YQmNX: } public function notSvg($KcXuZ) { return !$this->applyFilters("\x61\164\164\x61\143\150\155\x65\x6e\164\137\151\163\x5f\x73\166\147", false, $KcXuZ); } }
