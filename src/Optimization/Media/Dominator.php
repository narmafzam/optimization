<?php
 namespace Optimization\Media; use Boilerplate\Form\Form; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\PostUtil; use Boilerplate\Util\ThemeUtil; use ColorThief\ColorThief; use Exception; class Dominator extends Common { const DOMINATE_HEX_META = "\x64\157\155\x69\x6e\141\x74\x65\137\x68\145\170"; const DOMINATE_OVERRIDE_META = "\144\x6f\x6d\151\156\141\164\x65\x5f\157\x76\145\x72\162\151\144\145"; const DOMINATE_PLATTE_HEX_META = "\143\157\154\x6f\x72\x5f\x70\154\141\x74\x74\x65\137\x68\145\x78"; public function __construct() { goto tPwoe; tPwoe: if (!extension_loaded("\107\x44")) { goto pWAt2; } goto EWKgq; EWKgq: parent::__construct(); goto DQnZG; DQnZG: pWAt2: goto eg5ny; eg5ny: } public function addActions() : self { $this->addAction("\x61\144\144\x5f\141\x74\164\x61\143\x68\155\x65\x6e\164", [$this, "\165\160\x64\x61\164\x65\x43\x6f\x6c\157\x72\104\157\x6d\151\x6e\x61\156\x63\x65"]); return parent::addActions(); } public function addFilters() : self { $this->addFilter("\141\x74\x74\141\143\150\155\x65\x6e\164\x5f\x66\151\x65\154\x64\163\137\164\157\x5f\163\141\166\145", [$this, "\x73\x61\166\145\106\x69\x65\154\144"])->addFilter("\x61\x74\164\141\x63\x68\x6d\x65\x6e\164\x5f\x66\151\x65\x6c\x64\163\x5f\x74\x6f\137\x65\x64\x69\164", [$this, "\141\x64\x64\106\x69\145\x6c\x64"], 3)->addFilter("\x6f\x70\x74\151\155\151\172\141\x74\151\x6f\x6e\137\x6d\145\144\151\x61\x5f\x6c\141\172\171\137\154\x6f\141\144\137\160\x6c\141\x63\x65\150\x6f\154\144\145\x72", [$this, "\x67\145\x74\120\154\141\x63\x65\x68\157\154\x64\145\x72"], 3, 99); return parent::addFilters(); } public function getPlaceholder($placeholder, $attachment = null, $attributes = array()) { goto pFG9r; HTi3K: $width = ArrayUtil::get($attributes, "\x64\x61\x74\x61\55\167\x69\x64\164\x68"); goto SRBeK; JAPMm: $height = ArrayUtil::get($attributes, "\150\145\x69\x67\x68\x74"); goto JHjsw; QZly_: $width = $height = 100; goto nK5PB; sPwb6: if ($width) { goto T4y4d; } goto QZly_; jRdqI: wX7t8: goto sPwb6; pFG9r: $color = $this->srcColor("\43\60\x37\65\x37\x39\x38", $attachment); goto uSqKb; D0hEV: $color = str_replace("\x23", '', $color); goto lpmjQ; nK5PB: T4y4d: goto D0hEV; JHjsw: if ($width) { goto wX7t8; } goto HTi3K; uSqKb: $width = ArrayUtil::get($attributes, "\x77\x69\x64\164\x68"); goto JAPMm; lpmjQ: return "\x64\141\x74\x61\x3a\151\x6d\x61\x67\145\57\x73\166\x67\53\x78\155\x6c\x3b\x63\150\x61\162\x73\x65\164\x3d\x55\x54\x46\x2d\x38\54\45\63\x43\163\x76\147\45\x32\60\x78\155\x6c\156\163\x25\63\104\45\62\62\x68\x74\164\160\x25\63\x41\45\62\x46\x25\62\x46\x77\x77\167\x2e\x77\x33\x2e\157\x72\x67\45\62\x46\x32\x30\60\60\x25\x32\106\x73\x76\x67\45\x32\x32\x25\62\x30\167\151\144\164\150\x25\x33\x44\45\x32\62{$width}\45\62\x32\45\62\x30\150\145\151\x67\150\x74\45\x33\104\45\62\x32{$height}\45\x32\62\45\x32\x30\166\x69\145\x77\x42\x6f\170\45\63\x44\45\62\x32\x30\x25\x32\x30\x30\45\62\x30{$width}\x25\62\60{$height}\x25\x32\62\45\63\x45\45\63\x43\162\x65\143\x74\45\x32\x30\146\151\x6c\x6c\x25\x33\x44\x25\x32\62\x25\x32\63{$color}\45\62\62\x25\62\60\x77\x69\x64\164\150\x25\x33\104\x25\x32\62{$width}\45\62\x32\x25\62\60\150\145\151\147\x68\x74\x25\x33\104\45\x32\62{$height}\45\62\x32\45\62\x46\x25\x33\105\45\63\103\45\62\106\163\166\147\45\63\105"; goto VmWhB; SRBeK: $height = ArrayUtil::get($attributes, "\144\141\164\141\55\150\145\x69\x67\x68\x74"); goto jRdqI; VmWhB: } public function srcColor($color, $post = null) { goto n0w3j; CNV3l: XHSgA: goto gbt_u; Hirbl: $attachment = $post; goto H_7YQ; sdz5n: if (PostUtil::getType($post) !== "\141\164\164\x61\143\x68\x6d\x65\x6e\x74") { goto Ai2Tf; } goto Hirbl; n0w3j: $post = PostUtil::get($post, PostUtil::OBJECT, true); goto gpyXb; nQYBy: $attachment = PostUtil::getFeatureImageAttachment($post); goto lzyZq; zr0Hr: b51HU: goto CNV3l; Stph7: if (!$hex) { goto b51HU; } goto O7OoG; gbt_u: return $color; goto dtNUz; Bc4m9: Ai2Tf: goto nQYBy; lzyZq: Lukf8: goto K2b3c; H_7YQ: goto Lukf8; goto Bc4m9; K2b3c: $hex = PostUtil::getMeta(self::DOMINATE_HEX_META, true, $attachment); goto Stph7; gpyXb: if (!$post) { goto XHSgA; } goto sdz5n; O7OoG: $color = $hex; goto zr0Hr; dtNUz: } public function rgb2hex($rgb) { goto UZh8O; ZPiA0: mPf74: goto Lj4aB; hu5Qd: $hex .= str_pad(dechex($rgb[2]), 2, "\x30", STR_PAD_LEFT); goto ZPiA0; UZh8O: $hex = "\43"; goto akVb0; Lj4aB: return $hex; goto QFUK2; HzGhK: $hex .= str_pad(dechex($rgb[1]), 2, "\x30", STR_PAD_LEFT); goto hu5Qd; akVb0: if (is_array($rgb) && count($rgb) == 3) { goto dN3Eb; } goto BUJy8; gUfwg: dN3Eb: goto EU91F; EU91F: $hex .= str_pad(dechex($rgb[0]), 2, "\x30", STR_PAD_LEFT); goto HzGhK; uKdhU: goto mPf74; goto gUfwg; BUJy8: $hex .= "\x45\71\105\71\x45\x39"; goto uKdhU; QFUK2: } public function updateColorDominance($attachment) { goto UCt_T; UCt_T: if (!wp_attachment_is_image(PostUtil::getId($attachment))) { goto uPSBE; } goto mtGMJ; EQ6Jh: if (!$image) { goto SExdz; } goto lkCMU; OE9z3: $image = "{$directory["\142\x61\x73\145\x64\151\162"]}\57" . PostUtil::getMeta("\137\x77\x70\x5f\141\x74\164\x61\x63\150\x65\144\137\146\x69\154\x65", true, $attachment); goto EQ6Jh; mtGMJ: $directory = wp_upload_dir(); goto OE9z3; lkCMU: try { goto IuXDI; CEEnQ: if (!$color) { goto okLKh; } goto g0J8Y; IuXDI: $color = ColorThief::getColor($image); goto CEEnQ; et2Lx: okLKh: goto uHeqZ; Uiv10: foreach ($platte as $rgb) { $platteHex[] = $this->rgb2hex($rgb); s9Ysk: } goto Y12v2; UHFsd: $platteHex = []; goto Uiv10; Y12v2: CYDqZ: goto A6QBO; A6QBO: PostUtil::updateMeta(self::DOMINATE_PLATTE_HEX_META, $platteHex, $attachment); goto et2Lx; hmoxq: $platte = ColorThief::getPalette($image, 8); goto UHFsd; l5vuk: PostUtil::updateMeta(self::DOMINATE_HEX_META, $hex, $attachment); goto hmoxq; g0J8Y: $hex = $this->rgb2hex($color); goto l5vuk; uHeqZ: } catch (Exception $exception) { } goto dAEW1; dAEW1: SExdz: goto Rh3vA; Rh3vA: uPSBE: goto ug5eT; ug5eT: } public function addField($fields, $attachment) { goto QdHVq; cnoqs: XTC7O: goto uKQYk; mtn3N: foreach ($palette as $key => $color) { $colors[$color] = ThemeUtil::generateElement("\163\x70\141\x6e", ["\163\164\171\x6c\x65" => "\142\x61\x63\x6b\147\x72\x6f\165\x6e\x64\x2d\x63\x6f\x6c\157\x72\72\40{$color}\x3b", "\143\x6c\141\163\163" => "\x77\55\x31\60\x30"], true); F1xVj: } goto wUo_q; Uxch8: $colors = []; goto mtn3N; C3knn: $fields[self::DOMINATE_OVERRIDE_META] = ["\x69\x6e\x70\x75\x74" => "\150\164\155\x6c", "\x68\x74\155\154" => Form::getFormElement()->renderFields([Form::getCheckboxField(self::DOMINATE_OVERRIDE_META, __("\116\x6f\x20\x43\x6f\154\157\x72\x20\104\x6f\x6d\151\x6e\141\156\x63\x65\x20\x41\166\x61\x69\x6c\x61\142\x6c\x65\x2e", OPTIMIZATION_DOMAIN))->setDesc(__("\x43\150\145\143\x6b\x20\x74\150\x69\x73\x20\x69\x74\145\x6d\x20\x66\157\162\x20\x67\145\156\x65\x72\141\x74\145\40\144\157\x6d\151\156\141\x74\145\40\143\157\x6c\x6f\162\163\x2e", OPTIMIZATION_DOMAIN))], false)]; goto OjdNw; bf0VU: $fields[self::DOMINATE_HEX_META] = ["\x68\x74\x6d\154" => Form::getFormElement()->renderFields([Form::getRadioField(self::DOMINATE_HEX_META)->setOptions($colors)->setDefault(PostUtil::getMeta(self::DOMINATE_HEX_META, true, $attachment))->setInline(true)->addParentClass("\144\x6f\155\151\156\x61\156\x74\x2d\x63\157\154\x6f\162\x73")], false), "\151\x6e\160\165\164" => "\150\x74\x6d\x6c", "\154\141\142\145\154" => __("\104\x6f\155\x69\156\x61\156\x74\40\103\157\154\157\162", OPTIMIZATION_DOMAIN)]; goto N2j4Q; QdHVq: if (!$this->notSvg($attachment)) { goto XTC7O; } goto fbQeS; OjdNw: Wx0bv: goto cnoqs; FCyFw: if (!$palette) { goto pCcxv; } goto Uxch8; N2j4Q: goto Wx0bv; goto gdXc1; gdXc1: pCcxv: goto C3knn; wUo_q: eIvwB: goto bf0VU; uKQYk: return $fields; goto vuLoH; fbQeS: $palette = PostUtil::getMeta(self::DOMINATE_PLATTE_HEX_META, true, $attachment); goto FCyFw; vuLoH: } public function saveField($attachment) { goto Dwxe1; EL5HU: YRfZ8: goto xgWpS; EBOB3: t2JHw: goto f89Qe; ze0dq: if (CommonUtil::getRequest(self::DOMINATE_OVERRIDE_META, false)) { goto Q_0H1; } goto QTHJL; n2Rwg: goto MiISS; goto EBOB3; lEDvw: $this->updateColorDominance($attachment); goto n2Rwg; OCVpo: goto MiISS; goto BIt61; Dwxe1: if (!$this->notSvg($attachment)) { goto YRfZ8; } goto ze0dq; f89Qe: PostUtil::updateMeta(self::DOMINATE_HEX_META, $hex, $attachment); goto lNn_p; BIt61: Q_0H1: goto lEDvw; lNn_p: MiISS: goto EL5HU; xgWpS: return $attachment; goto e6o07; QTHJL: if ($hex = CommonUtil::getRequest(self::DOMINATE_HEX_META, false)) { goto t2JHw; } goto OCVpo; e6o07: } public function notSvg($attachment) { return !$this->applyFilters("\141\164\x74\141\143\150\155\x65\x6e\x74\137\x69\163\x5f\163\x76\x67", false, $attachment); } }
