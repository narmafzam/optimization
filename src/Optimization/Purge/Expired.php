<?php
 namespace Optimization\Purge; use Optimization\Util\FormatUtil; use Optimization\Util\I18NUtil; use CallbackFilterIterator; class Expired extends Common { const EVENT_NAME = "\x6f\x70\164\x69\155\x69\172\141\x74\151\157\x6e\137\160\x75\162\147\x65\137\164\151\155\x65\137\x65\166\x65\x6e\x74"; public function __construct(?string $path) { parent::__construct($path); } public function getPath() : ?string { return $this->path; } public function addActions() : self { $this->addAction("\x69\x6e\151\x74", [$this, "\163\x63\150\x65\x64\165\154\x65\105\166\x65\156\x74"]); return parent::addActions(); } public function scheduleEvent() { goto wkJpt; nHmT6: $interval = $this->get_interval(); goto gocF2; wkJpt: if (!($this->get_cache_lifespan() && !wp_next_scheduled(static::EVENT_NAME))) { goto Vf2hx; } goto nHmT6; gocF2: wp_schedule_event(time() + $interval, "\162\x6f\143\x6b\x65\x74\137\145\x78\x70\151\162\145\x64\137\x63\x61\x63\150\x65\137\143\162\x6f\156\x5f\x69\156\164\145\162\166\141\154", static::EVENT_NAME); goto ngip6; ngip6: Vf2hx: goto QIJEk; QIJEk: } private function isDirectoryEmpty($path) { goto Hvl2U; Hvl2U: $iterator = $this->getIterator($path); goto ebeWI; WCbD7: nfuge: goto p1ztL; p1ztL: return true; goto NJmo5; ebeWI: foreach ($iterator as $item) { goto qC0S5; qC0S5: if (!$item->isDot()) { goto e42kd; } goto X4M21; X4M21: goto l3eTy; goto dFevU; dFevU: e42kd: goto i7721; XPoNx: l3eTy: goto PvSUg; i7721: return false; goto XPoNx; PvSUg: } goto WCbD7; NJmo5: } private function getCacheFilesInDir($file) { goto BAr91; vZj0J: Ui1Tr: goto K30iz; NW2C3: $iterator = Util::getIterator($this->getPath()); goto VYkLS; VYkLS: $subDirectory = rtrim($file["\160\x61\164\x68"], "\x2f"); goto sZcDe; K30iz: return false; goto oHFgs; euiZB: return new CallbackFilterIterator($iterator, function ($current) use($pattern, $subDirectory) { goto xFPVD; oHlus: X3LCi: goto stAl0; X2Ajk: return false; goto oHlus; xFPVD: if (!(!$current->isDir() || $current->isDot())) { goto gq8IT; } goto n0EjS; fUu40: return false; goto j_viX; pWASU: gq8IT: goto Mo7WY; stAl0: if (!('' !== $subDirectory && !getFilesystem()::exists($current->getPathname() . $subDirectory))) { goto nFRfE; } goto fUu40; n0EjS: return false; goto pWASU; j_viX: nFRfE: goto mtPbd; mtPbd: return true; goto x63fI; Mo7WY: if (preg_match($pattern, $current->getFilename())) { goto X3LCi; } goto X2Ajk; x63fI: }); goto vZj0J; BAr91: $pattern = "\100\136" . preg_quote($file["\x68\x6f\x73\164"], "\x40") . "\100"; goto NW2C3; sZcDe: if (!$iterator) { goto Ui1Tr; } goto euiZB; oHFgs: } public function purgeExpiredFiles($lifespan) { goto cMzKR; BkUBV: dMsee: goto KzIT2; uM_px: A1t72: goto xe7A7; cMzKR: if (!$lifespan) { goto osGXP; } goto SFM0s; pTxr_: if (is_array($urls)) { goto m6fxV; } goto REG25; SFM0s: $default = $urls = I18NUtil::getUri(); goto v_BZP; v_BZP: $ageLimit = time() - $lifespan; goto KJSli; REG25: $urls = $default; goto zv6rl; KzIT2: $args = ["\x6c\x69\146\x65\x73\x70\141\156" => $lifespan, "\146\x69\154\x65\137\x61\147\x65\137\154\151\x6d\x69\164" => $ageLimit]; goto KgO09; EYKvF: $urls = array_filter($urls, "\151\x73\x5f\x73\164\162\x69\156\147"); goto GO9TT; bBPLC: $urls = array_unique($urls); goto D_8S3; zv6rl: m6fxV: goto EYKvF; GO9TT: $urls = array_filter($urls); goto W0WWL; KJSli: $urls = $this->applyFilters("\x63\x61\143\150\x65\x5f\x61\x75\164\x6f\155\x61\164\151\x63\x5f\x63\141\143\x68\x65\137\160\165\x72\147\145\137\165\162\154\x73", $urls, $ageLimit); goto pTxr_; TVdAJ: $cacheEnabled = Buffer::canGenerateCachingFiles(); goto gi1F3; D_8S3: $deleted = []; goto TVdAJ; W0WWL: if (!$urls) { goto A1t72; } goto bBPLC; gi1F3: foreach ($urls as $url) { goto moCBc; UFfSj: S346v: goto fqZTu; uDQLj: $sub_dir = rtrim($file["\160\x61\164\x68"], "\57"); goto BFCwM; moCBc: do_action("\x63\141\143\150\x65\x5f\x62\x65\x66\157\162\x65\x5f\x61\x75\164\157\x6d\141\x74\151\x63\137\x63\141\143\150\x65\x5f\160\165\162\x67\x65\x5f\x64\x69\x72", $url, $ageLimit); goto c_4gC; dh3Jz: foreach ($files as $item) { goto zXkZV; MGZ9S: odl0h: goto tpkxN; Ty3hl: eqxmY: goto MGZ9S; mmvzp: $itemPaths = $this->purgeDirectory($subDirectoryPath, $ageLimit); goto mfa7Z; y5N3K: if (!$this->isDirectoryEmpty($directoryPath)) { goto eqxmY; } goto M6sW7; ttivv: $deletedUrl[] = ["\150\157\155\145\x5f\x75\162\154" => $url, "\150\x6f\x6d\145\x5f\x70\x61\x74\150" => $subDirectoryPath, "\x6c\x6f\x67\147\x65\x64\137\x69\156" => $directoryPath !== $this->getPath() . $file["\x68\157\x73\x74"], "\146\151\x6c\x65\x73" => $itemPaths]; goto TxCGJ; M6sW7: getFilesystem()::remove($directoryPath); goto Ty3hl; zXkZV: $directoryPath = $item->getPathname(); goto XlrDD; XlrDD: $subDirectoryPath = $directoryPath . $sub_dir; goto mmvzp; TxCGJ: pRSRW: goto y5N3K; mfa7Z: if (!$itemPaths) { goto pRSRW; } goto ttivv; tpkxN: } goto UBhm1; UBhm1: vzDz5: goto ip1f2; sX1mA: $args = ["\165\162\x6c" => $url, "\154\x69\x66\145\163\x70\141\156" => $lifespan, "\146\151\x6c\145\137\x61\x67\x65\x5f\154\x69\x6d\151\164" => $ageLimit]; goto aYzLW; jdljW: dSbte: goto A2Y0l; aYzLW: do_action("\143\141\143\150\x65\x5f\x61\146\x74\145\x72\x5f\141\x75\x74\x6f\x6d\141\164\x69\x63\137\x63\141\143\x68\145\x5f\x70\165\x72\x67\x65\137\144\x69\x72", $deletedUrl, $args); goto UFfSj; BFCwM: $files = $this->getCacheFilesInDir($file); goto dh3Jz; cE6Pb: if (!$cacheEnabled) { goto a5i2_; } goto YrYKV; ndcVt: if (!$this->applyFilters("\x6f\x70\x74\151\x6d\x69\x7a\141\x74\151\x6f\x6e\137\165\162\x6c\x5f\x6e\x6f\137\144\x6f\164\x73", false)) { goto lFo6y; } goto x7iP8; njYai: $deleted = array_merge($deleted, $deletedUrl); goto jdljW; c_4gC: $deletedUrl = []; goto cE6Pb; x7iP8: $file["\150\x6f\x73\x74"] = str_replace("\56", "\137", $file["\x68\x6f\163\164"]); goto lNl_s; lNl_s: lFo6y: goto uDQLj; A2Y0l: a5i2_: goto sX1mA; YrYKV: $file = FormatUtil::getParseUrl($url); goto ndcVt; ip1f2: if (!$deletedUrl) { goto dSbte; } goto njYai; fqZTu: } goto BkUBV; xe7A7: osGXP: goto ITGgP; KgO09: do_action("\143\141\x63\150\145\x5f\141\146\x74\145\x72\x5f\x61\165\164\157\155\141\164\151\143\x5f\x63\141\x63\x68\145\x5f\160\x75\x72\147\x65", $deleted, $args); goto uM_px; ITGgP: } private function purgeDirectory($path, $ageLimit) { goto hQHOG; BcyWJ: if (!$this->isDirectoryEmpty($path)) { goto M5Xzb; } goto XMAnA; Qy7ga: foreach ($iterator as $item) { goto YZk5j; A3zm9: K5l4f: goto fKP14; XqAEb: $dirDeleted = $this->purgeDirectory($item->getPathname(), $ageLimit); goto ejeCK; oId7n: $filepath = $item->getPathname(); goto Avgzk; GDCsl: yBT37: goto EULED; ejeCK: $deleted = array_merge($deleted, $dirDeleted); goto ooQuK; tCjoq: goto sZeAf; goto FBAA8; YZk5j: if (!$item->isDot()) { goto K5l4f; } goto sjKqe; Avgzk: if (getFilesystem()::remove($filepath)) { goto VZqQV; } goto B_iPe; sjKqe: goto yBT37; goto A3zm9; Dtqqg: tUNVS: goto oId7n; hVvO8: WKG4r: goto Dj8nB; Dj8nB: sZeAf: goto GDCsl; y0GCP: VZqQV: goto pRQO2; fKP14: if ($item->isDir()) { goto bEhiM; } goto Ve69p; B_iPe: goto yBT37; goto y0GCP; pRQO2: $path = dirname($filepath); goto rcwzC; rcwzC: if (in_array($path, $deleted, true)) { goto WKG4r; } goto UjpNk; Ve69p: if ($item->isFile() && $item->getCTime() < $ageLimit) { goto tUNVS; } goto tCjoq; FBAA8: bEhiM: goto XqAEb; UjpNk: $deleted[] = $path; goto hVvO8; ooQuK: goto sZeAf; goto Dtqqg; EULED: } goto FJEfo; eBJEM: return $deleted; goto RUwVl; SWc3K: M5Xzb: goto eBJEM; DNgR3: $iterator = Util::getIterator($path); goto Qy7ga; XMAnA: getFilesystem()::remove($path); goto SWc3K; hQHOG: $deleted = []; goto DNgR3; FJEfo: m9LMe: goto BcyWJ; RUwVl: } }
