<?php
 namespace Optimization\Process; use Boilerplate\Process\Background; use Boilerplate\Util\AjaxUtil; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\PageUtil; use Optimization\Notice; use Optimization\Util\Util; class Batch extends Background { const OPTIMIZATION = "\x6f\160\164\x69\155\151\x7a\x61\x74\151\x6f\x6e\x5f"; const OPTIMIZATION_URLS = self::OPTIMIZATION . "\165\162\154\163"; const OPTIMIZATION_STARTED = self::OPTIMIZATION . "\163\164\x61\162\x74\x65\x64"; const RUNNING_PROCESS_TRANSITION = self::OPTIMIZATION . "\162\x75\x6e\156\151\x6e\147\137\160\162\157\143\145\x73\163"; public function __construct() { $this->action = "\x6f\160\164\x69\x6d\x69\x7a\x61\164\151\x6f\156\x5f\x62\x61\164\143\150\x5f\160\162\157\143\x65\163\163"; parent::__construct(); } public function addActions() : self { $this->addAction("\x61\x64\155\151\x6e\x5f\151\x6e\x69\164", [$this, "\x61\x64\x6d\x69\x6e\111\x6e\x69\164"], 0, 99)->addAction("\141\x66\x74\145\162\137\157\160\x74\151\x6d\151\172\x61\164\x69\x6f\156\x5f\x63\x6c\x65\x61\156\137\160\x6f\x73\x74", [$this, "\x6f\156\x43\x6c\x65\x61\x6e\x50\157\163\164"], 2, 99)->addAction("\x61\x66\x74\x65\162\x5f\x6f\160\164\151\155\x69\172\141\164\x69\x6f\156\137\143\x6c\x65\141\x6e\x5f\x64\x6f\155\141\x69\156", [$this, "\x72\x65\163\145\164\x50\162\x6f\x63\145\163\163"], 0, 99); return parent::addActions(); } public function onCleanPost($XIX7X, $vlmBW) { goto v7n8b; Aq5Jl: $vlmBW = array_unique(array_merge($vlmBW, $sVhRw), SORT_REGULAR); goto KOS4S; s_OJ5: $sVhRw = (array) Util::getOption(self::OPTIMIZATION_URLS, []); goto RLmE_; v7n8b: $vlmBW[] = PageUtil::getFrontPagePermalink(); goto s_OJ5; KOS4S: Util::updateOption(self::OPTIMIZATION_URLS, $vlmBW); goto BsGZD; BsGZD: icWFF: goto Y0Yp5; RLmE_: if (!(join('', $vlmBW) !== join('', $sVhRw))) { goto icWFF; } goto Aq5Jl; Y0Yp5: } public function resetProcess() { $this->complete(); Util::deleteOption(self::OPTIMIZATION_STARTED); } protected function complete() { goto lDxPn; SZhql: delete_transient(self::RUNNING_PROCESS_TRANSITION); goto UAqbc; lDxPn: parent::complete(); goto gzfm5; gzfm5: Util::deleteOption(self::OPTIMIZATION_URLS); goto SZhql; UAqbc: wp_cache_delete(self::RUNNING_PROCESS_TRANSITION, "\x74\162\x61\x6e\163\x69\x65\156\164"); goto hL43x; hL43x: } public function adminInit() { goto gVybk; AXdLI: Util::updateOption(self::OPTIMIZATION_STARTED, true); goto z0kVH; OK7sS: cYZyX: goto hFY4L; exPty: if (CommonUtil::getOption(self::OPTIMIZATION_STARTED, false)) { goto B7g3T; } goto xsmM6; XGzis: $this->startOptimization(); goto OK7sS; xsmM6: $this->maybeStartProcess(Util::getPublicPermalinks()); goto AXdLI; gVybk: if (AjaxUtil::isAjax()) { goto cYZyX; } goto exPty; z0kVH: B7g3T: goto XGzis; hFY4L: } public function startOptimization() { goto dipyH; h4Ajd: Util::deleteOption(self::OPTIMIZATION_URLS); goto Pyc6_; Pyc6_: Un33I: goto qkdim; uUs06: $this->maybeStartProcess($vlmBW, $IMdqE); goto h4Ajd; eD_tk: $IMdqE = md5(join('', $vlmBW)); goto uUs06; lojo1: if (!$vlmBW) { goto Un33I; } goto eD_tk; dipyH: $vlmBW = Util::getOption(self::OPTIMIZATION_URLS, []); goto lojo1; qkdim: } public function task($fnl_W) { goto X7MgK; O0SXL: return false; goto CcxbY; g0asb: $VVHCj = true; goto GW4Rk; ecfv1: $VVHCj = false; goto a6bvZ; Upc7Z: McmIh: goto O0SXL; a6bvZ: $vwB7A["\145\x72\162\x6f\x72\163"] = json_encode($LeuxT->errors); goto f7YJF; LdRjV: $this->updateRunningTransient($VVHCj); goto Upc7Z; qwVDY: if (!is_wp_error($LeuxT)) { goto OUFK4; } goto ecfv1; f7YJF: OUFK4: goto LdRjV; X7MgK: if (!$fnl_W) { goto McmIh; } goto g0asb; GW4Rk: $LeuxT = Util::sendOptRequest($fnl_W); goto qwVDY; CcxbY: } private function updateRunningTransient($ZR0Sv) { goto rN0Tw; eHQGw: $FdVTn = (int) ArrayUtil::get($IMdqE, "\x66\141\x69\154\145\144", 0); goto OE2m8; saAbP: hhpou: goto qEsLk; jK_Ga: $IMdqE = get_transient($nzF0q); goto LN1wW; KmUOg: xFADq: goto F6YQO; OE2m8: $VVHCj = (int) ArrayUtil::get($IMdqE, "\x73\165\143\143\x65\163\163", 0); goto TmM25; LN1wW: $yOKwM = (int) ArrayUtil::get($IMdqE, "\x74\x6f\164\141\x6c", 0); goto eHQGw; yU11O: $IMdqE["\146\141\151\x6c\145\144"] = ++$FdVTn; goto LF7ke; qEsLk: $IMdqE["\x73\165\143\x63\x65\x73\163"] = ++$VVHCj; goto KmUOg; rN0Tw: $nzF0q = self::RUNNING_PROCESS_TRANSITION; goto jK_Ga; TmM25: if ($ZR0Sv) { goto hhpou; } goto yU11O; F6YQO: set_transient($nzF0q, $IMdqE, $this->getExpire($yOKwM)); goto vIErH; LF7ke: goto xFADq; goto saAbP; vIErH: } public function generationRunningNotice() { goto uI1XH; UHPII: $VVHCj = ArrayUtil::get($IMdqE, "\x73\x75\x63\x63\x65\163\x73", 0); goto l1oHY; l1oHY: $FdVTn = ArrayUtil::get($IMdqE, "\146\141\151\x6c\x65\x64", 0); goto WrJX2; TnQbz: KaytL: goto W2ztQ; WrJX2: Notice::info(sprintf(__("\x4f\160\164\x69\155\x69\172\x61\164\151\x6f\x6e\x20\160\x72\x6f\143\145\x73\x73\40\x69\x73\40\x63\165\162\x72\x65\x6e\164\154\x79\40\x72\x75\156\156\x69\156\x67\72\x20\45\163\x20\x73\x75\x63\x63\x65\x73\x73\x20\141\x6e\144\x20\45\163\x20\x66\141\x69\154\145\144\40\x6f\x66\x20\x25\163\x20\x70\x61\x67\145\x20\x74\x79\x70\145\163\x20\143\157\155\x70\154\x65\x74\x65\144\x2e\x20\x28\x52\145\146\162\x65\163\150\x20\x74\x68\151\163\x20\x70\x61\147\145\40\x74\157\40\x76\x69\x65\x77\40\x70\162\x6f\147\162\x65\163\163\51", OPTIMIZATION_DOMAIN), $VVHCj, $FdVTn, $yOKwM), "\x6f\x70\164\151\155\151\172\141\x74\151\157\x6e"); goto TnQbz; VWvxN: if ($IMdqE && $yOKwM) { goto FcaJ0; } goto wbHqy; Grx6X: $yOKwM = ArrayUtil::get($IMdqE, "\x74\x6f\164\141\x6c", 0); goto VWvxN; uI1XH: $IMdqE = get_transient(self::RUNNING_PROCESS_TRANSITION); goto Grx6X; HCpKp: wp_cache_delete(self::RUNNING_PROCESS_TRANSITION, "\164\x72\141\x6e\x73\151\x65\x6e\164"); goto j0DeK; j0DeK: goto KaytL; goto dhst9; wbHqy: delete_transient(self::RUNNING_PROCESS_TRANSITION); goto HCpKp; dhst9: FcaJ0: goto UHPII; W2ztQ: } public function getExpire($yOKwM) { goto e9rrX; e9rrX: $o375o = $yOKwM / 500; goto nvXm9; nAAZf: UpPqE: goto Yg4Mv; Yg4Mv: return HOUR_IN_SECONDS * $o375o; goto Sg0xH; o6kJ3: $o375o = 1; goto nAAZf; nvXm9: if (!($o375o < 1)) { goto UpPqE; } goto o6kJ3; Sg0xH: } public function maybeStartProcess($xk0w4 = [], ?string $IMdqE = self::RUNNING_PROCESS_TRANSITION) { goto ESOlV; ESOlV: if (!($xk0w4 && $this->applyFilters("\157\x70\164\151\155\x69\172\x61\x74\x69\x6f\x6e\137\x64\157\137\157\160\x74\151\x6d\151\172\x61\x74\151\157\156\x5f\160\162\x6f\x63\x65\x73\x73", true) && (!$IMdqE || !get_transient($IMdqE)))) { goto XJPl5; } goto D5g1w; Xoqzs: $yOKwM = count($this->getData()); goto WlQkp; UMkSe: set_transient($IMdqE, $vwB7A, $this->getExpire($yOKwM)); goto Eu0xd; HL0MC: Notice::info(__("\x4f\160\164\151\x6d\x69\x7a\x61\x74\x69\x6f\156\x20\160\162\x6f\x63\145\x73\163\40\151\163\40\x63\x75\162\162\145\156\164\x6c\x79\x20\162\x75\156\156\x69\x6e\147\x2e", OPTIMIZATION_DOMAIN), "\x6f\x70\164\151\155\151\172\141\x74\x69\x6f\x6e"); goto Je1Iy; n7Cz2: if (!$IMdqE) { goto xGh8i; } goto Xoqzs; Eu0xd: xGh8i: goto oy93A; Je1Iy: XJPl5: goto YFDgO; D5g1w: array_map([$this, "\x70\x75\163\150\x32\x71\165\x65\165\x65"], $xk0w4); goto n7Cz2; WlQkp: $vwB7A = ["\164\x6f\164\141\x6c" => $yOKwM, "\x66\x61\x69\x6c\x65\144" => 0, "\163\x75\x63\x63\x65\163\x73" => 0]; goto UMkSe; oy93A: $this->save()->dispatch(); goto HL0MC; YFDgO: } }
