<?php
 namespace Optimization\Process; use Boilerplate\Process\Background; use Boilerplate\Util\AjaxUtil; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\PageUtil; use Optimization\Notice; use Optimization\Util\Util; class Batch extends Background { const OPTIMIZATION = "\x6f\160\x74\x69\x6d\x69\172\141\x74\151\157\x6e\137"; const OPTIMIZATION_URLS = self::OPTIMIZATION . "\x75\x72\x6c\x73"; const OPTIMIZATION_STARTED = self::OPTIMIZATION . "\163\x74\141\x72\x74\x65\144"; const RUNNING_PROCESS_TRANSITION = self::OPTIMIZATION . "\x72\x75\x6e\x6e\151\156\147\x5f\x70\162\157\143\x65\x73\163"; public function __construct() { $this->action = "\x6f\x70\x74\x69\155\x69\x7a\x61\x74\x69\x6f\x6e\137\x62\141\x74\x63\150\137\160\x72\x6f\x63\x65\163\163"; parent::__construct(); } public function addActions() : self { $this->addAction("\x61\x64\x6d\x69\156\x5f\x69\x6e\x69\164", [$this, "\x61\144\155\151\x6e\111\x6e\151\164"], 0, 99)->addAction("\x61\x66\x74\145\x72\x5f\157\x70\164\151\x6d\151\172\141\x74\x69\x6f\156\137\143\154\x65\141\x6e\137\160\157\x73\164", [$this, "\157\156\x43\x6c\x65\x61\x6e\120\x6f\x73\x74"], 2, 99)->addAction("\x61\x66\164\x65\x72\137\x6f\160\164\151\x6d\x69\x7a\141\164\151\x6f\156\x5f\x63\154\145\141\x6e\x5f\144\157\x6d\x61\151\156", [$this, "\x72\145\163\145\x74\120\x72\157\x63\x65\163\163"], 0, 99); return parent::addActions(); } public function onCleanPost($XIX7X, $vlmBW) { goto bKri8; utEga: $sVhRw = (array) Util::getOption(self::OPTIMIZATION_URLS, []); goto E1eud; V22t2: Util::updateOption(self::OPTIMIZATION_URLS, $vlmBW); goto M9qV6; E1eud: if (!(join('', $vlmBW) !== join('', $sVhRw))) { goto IZGjq; } goto ZTxCx; bKri8: $vlmBW[] = PageUtil::getFrontPagePermalink(); goto utEga; ZTxCx: $vlmBW = array_unique(array_merge($vlmBW, $sVhRw), SORT_REGULAR); goto V22t2; M9qV6: IZGjq: goto HsFii; HsFii: } public function resetProcess() { $this->complete(); Util::deleteOption(self::OPTIMIZATION_STARTED); } protected function complete() { goto Dsnyq; Dsnyq: parent::complete(); goto yM3m0; MVnzL: wp_cache_delete(self::RUNNING_PROCESS_TRANSITION, "\164\162\141\156\x73\151\145\156\164"); goto JmISe; yM3m0: Util::deleteOption(self::OPTIMIZATION_URLS); goto rfaz2; rfaz2: delete_transient(self::RUNNING_PROCESS_TRANSITION); goto MVnzL; JmISe: } public function adminInit() { goto atrjp; ffiqA: $this->startOptimization(); goto u1Mz2; pjLIs: if (CommonUtil::getOption(self::OPTIMIZATION_STARTED, false)) { goto lPV86; } goto Pajz_; NHtcU: lPV86: goto ffiqA; u1Mz2: FzG7T: goto bkcxu; Y0WBE: Util::updateOption(self::OPTIMIZATION_STARTED, true); goto NHtcU; atrjp: if (AjaxUtil::isAjax()) { goto FzG7T; } goto pjLIs; Pajz_: $this->maybeStartProcess(Util::getPublicPermalinks()); goto Y0WBE; bkcxu: } public function startOptimization() { goto wYYBR; wYYBR: $vlmBW = Util::getOption(self::OPTIMIZATION_URLS, []); goto nKn4d; rupSh: hkQn4: goto Lpqzu; PNGIr: $IMdqE = md5(join('', $vlmBW)); goto NhX4n; NhX4n: $this->maybeStartProcess($vlmBW, $IMdqE); goto aiPJp; aiPJp: Util::deleteOption(self::OPTIMIZATION_URLS); goto rupSh; nKn4d: if (!$vlmBW) { goto hkQn4; } goto PNGIr; Lpqzu: } public function task($fnl_W) { goto M4EBl; vapiR: if (!is_wp_error($LeuxT)) { goto JcPnb; } goto j2vM5; hFscz: JcPnb: goto sHIj9; j2vM5: $VVHCj = false; goto IH2o3; wHucF: $LeuxT = Util::sendOptRequest($fnl_W); goto vapiR; sHIj9: $this->updateRunningTransient($VVHCj); goto cq4xg; M4EBl: if (!$fnl_W) { goto w2i3K; } goto pnqA7; bYfad: return false; goto doBGb; pnqA7: $VVHCj = true; goto wHucF; cq4xg: w2i3K: goto bYfad; IH2o3: $vwB7A["\x65\x72\x72\x6f\x72\x73"] = json_encode($LeuxT->errors); goto hFscz; doBGb: } private function updateRunningTransient($ZR0Sv) { goto mDK74; w2saW: $FdVTn = (int) ArrayUtil::get($IMdqE, "\x66\x61\x69\154\x65\144", 0); goto J0qoW; iJp_l: $yOKwM = (int) ArrayUtil::get($IMdqE, "\164\157\164\141\154", 0); goto w2saW; XxGGB: $IMdqE["\x66\141\x69\x6c\145\144"] = ++$FdVTn; goto gOGTB; TD7wO: bKrHi: goto icWMR; gOGTB: goto bKrHi; goto U6y3G; fQATH: $IMdqE["\x73\165\143\143\145\163\163"] = ++$VVHCj; goto TD7wO; mDK74: $nzF0q = self::RUNNING_PROCESS_TRANSITION; goto Jvkot; k5ReF: if ($ZR0Sv) { goto jDLIj; } goto XxGGB; U6y3G: jDLIj: goto fQATH; J0qoW: $VVHCj = (int) ArrayUtil::get($IMdqE, "\163\165\143\x63\x65\x73\163", 0); goto k5ReF; icWMR: set_transient($nzF0q, $IMdqE, $this->getExpire($yOKwM)); goto zpz15; Jvkot: $IMdqE = get_transient($nzF0q); goto iJp_l; zpz15: } public function generationRunningNotice() { goto XW1tl; XW1tl: $IMdqE = get_transient(self::RUNNING_PROCESS_TRANSITION); goto RQNdG; QqHzG: goto ST1vV; goto ZsGVs; ZsGVs: g6P3V: goto jc0S8; SA4Iz: delete_transient(self::RUNNING_PROCESS_TRANSITION); goto grYw0; jc0S8: $VVHCj = ArrayUtil::get($IMdqE, "\163\165\x63\x63\x65\163\163", 0); goto ZeWUx; RAGFT: Notice::info(sprintf(__("\x4f\x70\x74\x69\x6d\151\172\141\x74\151\x6f\x6e\x20\160\162\157\143\145\x73\x73\x20\x69\x73\40\143\x75\x72\x72\145\156\x74\154\171\40\162\165\x6e\156\x69\x6e\x67\x3a\40\x25\x73\40\163\x75\143\x63\145\x73\x73\x20\141\x6e\144\40\x25\163\x20\x66\x61\x69\154\x65\144\40\x6f\146\40\45\x73\x20\160\141\x67\x65\x20\164\x79\160\x65\163\x20\143\x6f\155\160\154\x65\x74\145\144\56\x20\x28\122\145\x66\x72\145\x73\150\40\x74\150\x69\163\x20\160\141\147\145\40\164\157\40\166\151\x65\x77\40\160\x72\157\x67\x72\145\x73\x73\x29", OPTIMIZATION_DOMAIN), $VVHCj, $FdVTn, $yOKwM), "\x6f\160\164\151\x6d\x69\x7a\141\164\151\x6f\x6e"); goto F9V3Y; F9V3Y: ST1vV: goto UeLP4; RQNdG: $yOKwM = ArrayUtil::get($IMdqE, "\x74\x6f\164\141\x6c", 0); goto QjHUa; QjHUa: if ($IMdqE && $yOKwM) { goto g6P3V; } goto SA4Iz; grYw0: wp_cache_delete(self::RUNNING_PROCESS_TRANSITION, "\164\x72\x61\156\163\x69\x65\x6e\164"); goto QqHzG; ZeWUx: $FdVTn = ArrayUtil::get($IMdqE, "\x66\141\x69\x6c\x65\144", 0); goto RAGFT; UeLP4: } public function getExpire($yOKwM) { goto EZLX3; EZLX3: $o375o = $yOKwM / 500; goto ix9VA; Q1RmG: aOPPe: goto Ky3Y9; hJsIO: $o375o = 1; goto Q1RmG; Ky3Y9: return HOUR_IN_SECONDS * $o375o; goto zawMQ; ix9VA: if (!($o375o < 1)) { goto aOPPe; } goto hJsIO; zawMQ: } public function maybeStartProcess($xk0w4 = [], ?string $IMdqE = self::RUNNING_PROCESS_TRANSITION) { goto L34fJ; pWBi7: if (!$IMdqE) { goto vhrDa; } goto u50hQ; GoIKM: array_map([$this, "\x70\165\163\x68\x32\161\165\145\x75\145"], $xk0w4); goto pWBi7; Rh1Sq: vhrDa: goto XI0ar; cjEWN: $vwB7A = ["\164\x6f\164\141\x6c" => $yOKwM, "\x66\141\x69\154\145\x64" => 0, "\163\x75\143\x63\145\x73\163" => 0]; goto gETB4; L34fJ: if (!($xk0w4 && $this->applyFilters("\x6f\x70\x74\x69\x6d\x69\172\x61\164\151\x6f\156\x5f\144\157\137\157\160\x74\151\x6d\x69\172\x61\x74\x69\157\x6e\137\160\162\157\143\x65\x73\x73", true) && (!$IMdqE || !get_transient($IMdqE)))) { goto PQ_aH; } goto GoIKM; leG53: Notice::info(__("\x4f\160\x74\151\155\151\x7a\x61\x74\x69\157\x6e\40\x70\162\157\143\145\163\163\x20\x69\x73\x20\x63\165\x72\x72\145\156\164\154\x79\x20\x72\x75\156\156\151\156\x67\x2e", OPTIMIZATION_DOMAIN), "\x6f\160\x74\x69\155\151\x7a\141\164\x69\x6f\x6e"); goto pIjf1; gETB4: set_transient($IMdqE, $vwB7A, $this->getExpire($yOKwM)); goto Rh1Sq; pIjf1: PQ_aH: goto sGn0f; XI0ar: $this->save()->dispatch(); goto leG53; u50hQ: $yOKwM = count($this->getData()); goto cjEWN; sGn0f: } }
