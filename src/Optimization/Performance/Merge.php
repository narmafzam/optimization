<?php
 namespace Optimization\Performance; use Boilerplate\DOMCrawler; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\ThemeUtil; use DOMElement; use Optimization\Notice; use Optimization\Util\Util; class Merge extends Common { public function __construct() { goto NskAJ; VfBCO: yHJ_V: goto uxTb0; E6idG: parent::__construct(); goto VfBCO; NskAJ: if (!$this->loadConstant()) { goto yHJ_V; } goto E6idG; uxTb0: } public function addFilters() : self { $this->addFilter("\157\160\164\151\155\x69\172\x61\x74\151\x6f\156\x5f\x62\x75\x66\146\145\162\x5f\160\x72\157\x63\145\163\163", [$this, "\160\141\143\153\x53\x74\171\154\145\x73\150\x65\x65\x74\x73"], 1, 0)->addFilter("\157\x70\164\151\155\x69\x7a\x61\164\x69\x6f\156\x5f\x62\x75\x66\146\145\x72\137\160\162\x6f\x63\145\163\x73", [$this, "\x70\141\143\x6b\123\143\162\151\160\x74\x73"], 1, 0); return parent::addFilters(); } public function loadConstant() { goto wheUM; ptvMj: goto W2w6R; goto lr6Tj; jlDHj: return $return; goto Bhk7P; CYQQ2: W2w6R: goto jlDHj; n4KxJ: define("\x4f\120\x54\x49\115\x49\x5a\x41\124\111\117\116\x5f\115\105\x52\x47\105\x5f\x50\101\x54\x48", "{$path}\x2f\x6d\x65\162\x67\x65"); goto T1fpz; YaAzv: Notice::warning(sprintf(__("\x25\x73\40\143\157\156\163\164\141\x6e\x74\x20\156\x6f\x74\40\x64\x65\146\151\x6e\145\x64\54\40\x70\x6c\145\141\163\145\x20\x64\x65\146\151\156\145\40\x74\x68\141\164\40\151\x6e\40\x77\160\x2d\x63\x6f\156\146\x69\x67\x2e\160\150\x70\56", OPTIMIZATION_DOMAIN), "\74\x63\x6f\x64\x65\76\127\x50\x5f\x43\101\103\110\x45\x5f\120\x41\x54\x48\x3c\57\x63\157\x64\x65\76")); goto ptvMj; wheUM: $return = false; goto bO9Qq; bO9Qq: if ($path = Util::getConstant("\x57\120\137\x43\x41\x43\x48\105\x5f\x50\101\124\x48")) { goto jG_Vf; } goto YaAzv; lr6Tj: jG_Vf: goto n4KxJ; T1fpz: $return = $this->getFilesystem()->mkdir(OPTIMIZATION_MERGE_PATH); goto CYQQ2; Bhk7P: } public function packScripts($buffer) { return $buffer; } public function packStylesheets($buffer) { goto nm0Ss; LOe1x: EaNpj: goto aPnxD; EeN7T: $element = ThemeUtil::generateElement("\x6c\x69\x6e\153", ["\150\162\x65\146" => $url, "\x72\145\154" => "\x73\164\171\x6c\145\x73\x68\x65\145\x74", "\151\144" => $filename], false); goto NELgZ; aPnxD: return $buffer; goto ybAMG; lOgfH: if (!$styles) { goto EaNpj; } goto voi2r; jmyHV: kT8Il: goto LOe1x; voi2r: if (!($url = $this->createFile("{$filename}\56\x63\x73\163", $styles))) { goto kT8Il; } goto Arbu3; nm0Ss: $styles = $this->getAssetsContent($buffer, "\x6c\x69\156\x6b\133\162\x65\x6c\x3d\x73\x74\171\154\x65\x73\150\x65\x65\x74\x5d", $filename); goto lOgfH; Arbu3: $buffer = DOMCrawler::removeElements($buffer, "\133\x64\141\164\141\x2d\x6d\x65\162\147\x65\x64\x3d\61\135"); goto EeN7T; NELgZ: $buffer = str_replace("\74\x2f\x68\x65\141\x64\x3e", "{$element}\74\57\150\145\141\144\76", $buffer); goto jmyHV; ybAMG: } public function getAssetsContent(&$buffer, $selector, &$cacheKey = null) { goto X5aBX; k5Ff5: $content = ''; goto x5P9E; GkJ1i: if (!(count($paths) > $threshold)) { goto MeHTF; } goto AVpAE; a4G3v: $wpinc = CommonUtil::getConstant("\127\120\111\116\x43"); goto N8c1H; BvcTA: $filesystem = $this->getFilesystem(); goto HFE0V; RjpnB: $cacheKey = md5(implode('', $cacheKey)); goto BvcTA; AVpAE: $cacheKey = array_map("\x62\141\x73\x65\156\141\155\x65", $paths); goto CWq4c; HFE0V: foreach ($paths as $path) { $content .= $filesystem->getContent($path); qonFU: } goto tzFI2; tzFI2: HBZfJ: goto YWNuH; N8c1H: $prefixes = [CommonUtil::getConstant("\127\x50\x5f\x43\117\x4e\124\x45\x4e\x54\137\104\111\x52") => site_url() . "\57\167\x70\x2d\143\157\x6e\x74\145\156\x74", CommonUtil::getConstant("\x41\102\123\x50\101\x54\x48") . $wpinc => site_url() . "\x2f{$wpinc}"]; goto MGi_y; MGi_y: $buffer = DOMCrawler::elementsMap($buffer, $selector, function (DOMElement $node) use(&$paths, $prefixes) { goto mvPin; cxThJ: if (!$link) { goto s_ejf; } goto tGk1M; Y6v9i: return $node; goto Kj7CQ; mvPin: $link = $node->getAttribute("\x68\x72\x65\x66"); goto cxThJ; B6Os4: SylEW: goto QN6Mn; QN6Mn: s_ejf: goto Y6v9i; tGk1M: foreach ($prefixes as $path => $prefix) { goto u_OFR; BX2FL: $paths[] = str_replace($prefixes, $path, $link); goto CC24T; ftXrZ: nghjG: goto v5dfU; u_OFR: if (!(strpos($link, $prefix) !== false)) { goto E_kRt; } goto BX2FL; Hs2eB: E_kRt: goto ftXrZ; CC24T: $node->setAttribute("\x64\x61\x74\x61\x2d\155\145\x72\x67\145\144", 1); goto Hs2eB; v5dfU: } goto B6Os4; Kj7CQ: }); goto k5Ff5; YWNuH: MeHTF: goto Exlp0; Exlp0: return $content; goto AWlAJ; X5aBX: $paths = []; goto a4G3v; x5P9E: $threshold = (int) $this->applyFilters("\157\x70\x74\151\x6d\151\172\x61\164\151\x6f\156\137\x70\145\162\x66\157\162\155\x61\x6e\x63\145\x5f\x6d\x65\x72\x67\x65\x5f\164\x68\x72\x65\x73\150\x6f\x6c\x64", 2); goto GkJ1i; CWq4c: sort($cacheKey); goto RjpnB; AWlAJ: } public function createFile($filename, $content) { goto njIDd; FKKDJ: $url = content_url() . str_replace($contentDir, '', $filepath); goto NH_6v; OMQsE: $contentDir = CommonUtil::getConstant("\x57\120\137\103\x4f\116\124\105\116\124\x5f\x44\111\x52"); goto DVsIv; miACx: if (!($contentDir && ($this->getFilesystem()->exists($filepath) || $this->getFilesystem()->putContent($filepath, $content)))) { goto vxDFx; } goto FKKDJ; DVsIv: $filepath = "{$path}\x2f{$filename}"; goto miACx; MtIoL: return $url; goto MhciD; NH_6v: vxDFx: goto Qgv1T; dflfD: if (!($filename && $path)) { goto gHrwp; } goto OMQsE; njIDd: $path = CommonUtil::getConstant("\x4f\x50\x54\x49\115\x49\x5a\x41\x54\111\x4f\116\137\115\105\x52\107\x45\x5f\x50\x41\124\110"); goto wmGtn; wmGtn: $url = false; goto dflfD; Qgv1T: gHrwp: goto MtIoL; MhciD: } }
