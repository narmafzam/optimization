<?php
 namespace Optimization\Combine; use Boilerplate\DOMCrawler; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\StringUtil; use Boilerplate\Util\ThemeUtil; use DOMElement; use Optimization\Data\Source; use Optimization\Notice; use Optimization\Util\Util; class Combine extends Common { const ASSETS_REGEX = "\x2f\165\162\154\x5c\163\52\x5c\50\x5c\x73\52\50\77\41\133\x22\47\x5d\x3f\x64\x61\x74\141\72\51\50\x3f\41\x5b\x27\174\134\42\x5d\77\133\x5c\x23\x7c\x5c\x25\x7c\x5d\x29\x28\x5b\136\51\135\x2b\x29\x5c\163\52\134\51\50\x5b\136\73\175\x2c\x5c\x73\x5d\52\51\x2f\151"; public function __construct() { goto u746i; u746i: if (!$this->loadConstant()) { goto zo0yj; } goto uRUPM; uRUPM: parent::__construct(); goto m59jp; m59jp: zo0yj: goto Fli5H; Fli5H: } public function addFilters() : self { $this->addFilter("\157\x70\x74\151\155\x69\x7a\x61\x74\151\x6f\x6e\137\x62\165\x66\x66\145\x72\x5f\x70\x72\157\x63\x65\163\x73", [$this, "\155\141\x79\x62\145\x49\156\151\164\x50\162\x6f\x63\x65\x73\x73"]); return parent::addFilters(); } public function loadConstant() { goto S5Lie; h8cXK: return $pHq9s; goto aJwGJ; HOEw7: DeZov: goto h8cXK; mLQhN: if ($GuTuU = Util::getConstant("\127\120\137\103\101\x43\x48\x45\137\x50\x41\x54\x48")) { goto lfx0A; } goto pei0X; T1VWq: lfx0A: goto HaGBq; HaGBq: define("\117\120\124\111\x4d\111\x5a\101\x54\x49\x4f\116\137\x43\117\115\x42\111\116\x45\x5f\x50\x41\124\x48", "{$GuTuU}\57\x63\x6f\x6d\142"); goto O4GKz; O4GKz: $pHq9s = $this->getFilesystem()->mkdir(OPTIMIZATION_COMBINE_PATH); goto HOEw7; S5Lie: $pHq9s = false; goto mLQhN; pei0X: Notice::warning(sprintf(__("\45\163\x20\x63\157\x6e\x73\164\141\156\x74\40\156\157\164\x20\144\145\x66\x69\156\145\x64\54\40\x70\x6c\145\x61\163\145\40\x64\x65\x66\x69\156\145\40\x74\x68\x61\164\40\x69\x6e\x20\x77\x70\x2d\x63\157\156\x66\151\x67\x2e\160\x68\160\56", OPTIMIZATION_DOMAIN), "\x3c\143\x6f\x64\x65\76\127\x50\x5f\103\x41\x43\110\105\137\x50\x41\x54\x48\74\57\x63\157\144\145\x3e")); goto lzTm3; lzTm3: goto DeZov; goto T1VWq; aJwGJ: } public function rewriteAssets($B6fu9, $iSNOk) { goto ajSHH; bn0VV: if (!($tQVlb && $iSNOk)) { goto VpHp5; } goto RPqBZ; SShaP: $B6fu9 = $this->replaceAssets($B6fu9, $IRToU); goto H0T02; NQGwo: $SZK3T = ArrayUtil::get(wp_parse_url($Gmm3u), "\x68\x6f\x73\164"); goto CAtnd; WsA2P: return $B6fu9; goto keTcJ; lUM3L: foreach ($upoja[1] as $Lu_9j) { goto FZ9dV; JgyZg: SfueX: goto Q3Qlg; EucqC: if (!$A41gN) { goto SfueX; } goto KM3Xg; KM3Xg: $IRToU[$Lu_9j] = "\x2f\57" . str_replace($tQVlb, $SZK3T, $A41gN); goto JgyZg; FZ9dV: $hgTz4 = trim($Lu_9j, "\x20\x9\xa\xd\0\13\42\x27"); goto rb1oO; Q3Qlg: zdeFE: goto wTvwZ; rb1oO: $A41gN = realpath("{$aOJ92}{$hgTz4}"); goto EucqC; wTvwZ: } goto Z6DRx; Z6DRx: QmVdV: goto ai5IU; CAtnd: preg_match_all(self::ASSETS_REGEX, $B6fu9, $upoja); goto fMf3G; ai5IU: OWkf_: goto SShaP; mPRX_: $IRToU = []; goto NQGwo; H0T02: VpHp5: goto WsA2P; o6uKH: $Gmm3u = site_url(); goto bn0VV; ajSHH: $tQVlb = untrailingslashit(CommonUtil::getConstant("\101\102\123\x50\101\124\110")); goto o6uKH; RPqBZ: $aOJ92 = $tQVlb . trailingslashit(dirname(str_replace($Gmm3u, '', $iSNOk))); goto mPRX_; fMf3G: if (!(is_array($upoja) && $upoja)) { goto OWkf_; } goto lUM3L; keTcJ: } public function replaceAssets($B6fu9, $VWdyW = array()) { goto e4f4m; rJQ_h: $zfbty = array_map("\x73\164\x72\154\x65\156", array_keys($VWdyW)); goto TuKei; TuKei: array_multisort($zfbty, SORT_DESC, $VWdyW); goto qYFCg; qYFCg: $B6fu9 = str_replace(array_keys($VWdyW), array_values($VWdyW), $B6fu9); goto Z8BKt; e4f4m: if (!$VWdyW) { goto GbuSc; } goto rJQ_h; Oqkka: return $B6fu9; goto GDYy2; Z8BKt: GbuSc: goto Oqkka; GDYy2: } public function maybeInitProcess($vwY7Y) { $vwY7Y = $this->combineFiles($vwY7Y, "\154\151\156\x6b\133\150\x72\x65\146\135\133\x72\x65\x6c\75\163\x74\171\x6c\x65\x73\150\145\145\164\135", "\154\x69\x6e\153", "\150\x72\145\146"); return $vwY7Y; } public function combineSources($X7olV) { goto TXw6f; fFaF_: jWSmD: goto MkTsY; L2wSY: foreach ($X7olV as $o9yCo) { goto pjkjL; IVYS3: $o9yCo->setCombined(true); goto Mmbiq; NqVaT: $kZx0K = array_merge($this->combineSources($o9yCo->getDependencies()), $kZx0K); goto sYuRP; sYuRP: eDsF7: goto hcbmg; P8E4y: VzSmg: goto yblGh; QTQVO: if (!$B6fu9) { goto uJyMa; } goto DsmHx; ajOJW: MFib3: goto P8E4y; AvIZ_: $B6fu9 = $yb0zb->getContent($GuTuU); goto QTQVO; pjkjL: if (!$o9yCo instanceof Source) { goto MFib3; } goto a9wZO; Mmbiq: $kZx0K[$o9yCo->getHandle()] = $B6fu9; goto mQ7yR; DsmHx: $B6fu9 = $this->rewriteAssets($B6fu9, $o9yCo->getUrl()); goto IVYS3; mQ7yR: if (!$o9yCo->getDependencies()) { goto eDsF7; } goto NqVaT; hcbmg: uJyMa: goto ajOJW; a9wZO: $GuTuU = $o9yCo->getPath(); goto AvIZ_; yblGh: } goto fFaF_; MkTsY: return $kZx0K; goto PnunH; TXw6f: $kZx0K = []; goto qKuwS; qKuwS: $yb0zb = $this->getFilesystem(); goto L2wSY; PnunH: } public function isCombined($D2KXr) : bool { return $this->getFilesystem()->exists($D2KXr); } public function getFilePath($EOJKs, $jDNPs) : string { $GuTuU = CommonUtil::getConstant("\x4f\120\124\111\115\111\132\101\x54\111\117\116\137\103\117\x4d\x42\111\x4e\105\137\120\x41\124\110"); return "{$GuTuU}\x2f{$jDNPs}\x2f{$EOJKs}\x2e{$jDNPs}"; } public function combineFiles($vwY7Y, $C2Sin, $uL8fN, $M6cdG) { goto PhmKJ; ksfYm: return $vwY7Y; goto iBokb; vQIlN: fy5vr: goto uDEKX; ZO6kE: if (!$kZx0K) { goto oSFMz; } goto Xj0jF; d8zVc: $vwY7Y = StringUtil::replaceFirst("\74\x2f\x68\145\141\x64\x3e", "{$H4FTE}\74\57\150\145\x61\x64\76", $vwY7Y); goto Kq8QN; XAD0B: $D2KXr = $this->getFilePath($EOJKs, $jDNPs); goto Mihs_; yY45W: $vwY7Y = DOMCrawler::elementsMap($vwY7Y, $C2Sin, function (DOMElement $oMvxH) use(&$X7olV, $M6cdG) { goto uOheD; tzeOO: if (!$RuYo3) { goto AThLu; } goto HN02q; HdnxR: $oMvxH->parentNode->removeChild($oMvxH); goto W3Vm0; W3Vm0: AThLu: goto Zne9g; YRCSB: $X7olV[basename($GuTuU)] = (new Source())->setUrl($o9yCo)->setPath($GuTuU)->setType($oMvxH->nodeName)->setHandle($oMvxH->getAttribute("\x69\x64")); goto HdnxR; HN02q: $GuTuU = str_replace($RuYo3["\x70\x61\x74\150\137\x75\162\x6c"], $RuYo3["\160\x61\x74\150"], $o9yCo); goto YRCSB; SHskr: $RuYo3 = $this->getSourcePath($o9yCo); goto tzeOO; Zne9g: return $oMvxH; goto vKIb3; uOheD: $o9yCo = remove_query_arg("\x76\x65\x72", $oMvxH->getAttribute($M6cdG)); goto SHskr; vKIb3: }); goto y_g1v; kWbr8: $EOJKs = md5(implode('', array_keys($X7olV))); goto XAD0B; dlkYe: if (!$H4FTE) { goto uH0Hw; } goto E2Ril; LbEQW: $Lh3fh["\144\x65\146\x66\145\x72"] = true; goto gDjJf; E2Ril: $Lh3fh = ["\x69\x64" => "\143\x6f\x6d\142\x69\156\145\144\55{$jDNPs}", $M6cdG => str_replace(CommonUtil::getConstant("\x41\102\123\120\101\x54\110"), trailingslashit(site_url()), $D2KXr)]; goto PK5lS; nDH3X: $Lh3fh["\x61\163\171\156\x63"] = true; goto LbEQW; ysMQR: $H4FTE = ThemeUtil::generateElement($uL8fN, $Lh3fh); goto d8zVc; Mihs_: $H4FTE = true; goto wJZFS; PhmKJ: $X7olV = []; goto yY45W; y_g1v: $jDNPs = $uL8fN == "\154\151\x6e\153" ? "\143\x73\x73" : "\x6a\163"; goto kWbr8; Xj0jF: $kZx0K = $this->applyFilters("\157\160\164\151\x6d\151\x7a\x61\164\151\157\x6e\137\x6d\x69\x6e\151\x66\171\x5f{$jDNPs}", implode('', $kZx0K), $D2KXr); goto AJxRw; wJZFS: if ($this->isCombined($D2KXr)) { goto cgNeO; } goto RLoG_; A1eJy: cgNeO: goto dlkYe; Kq8QN: uH0Hw: goto ksfYm; CPPmM: oSFMz: goto A1eJy; yg6OQ: sqjYA: goto ysMQR; RLoG_: $kZx0K = $this->combineSources($X7olV); goto ZO6kE; gDjJf: goto sqjYA; goto vQIlN; PK5lS: if ($jDNPs == "\x63\x73\163") { goto fy5vr; } goto nDH3X; AJxRw: $H4FTE = $this->getFilesystem()->putContent($D2KXr, $kZx0K); goto CPPmM; uDEKX: $Lh3fh["\162\145\x6c"] = "\x73\164\x79\x6c\145\x73\x68\x65\145\x74"; goto yg6OQ; iBokb: } }
