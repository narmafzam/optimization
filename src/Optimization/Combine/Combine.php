<?php
 namespace Optimization\Combine; use Boilerplate\DOMCrawler; use Boilerplate\Util\ArrayUtil; use Boilerplate\Util\CommonUtil; use Boilerplate\Util\StringUtil; use Boilerplate\Util\ThemeUtil; use DOMElement; use Optimization\Data\Source; use Optimization\Notice; use Optimization\Util\Util; class Combine extends Common { const ASSETS_REGEX = "\57\x75\162\154\x5c\x73\x2a\134\x28\134\163\x2a\50\77\x21\x5b\x22\x27\x5d\x3f\144\141\x74\141\x3a\x29\50\77\x21\133\47\x7c\134\x22\x5d\x3f\x5b\134\43\x7c\x5c\45\174\135\51\x28\133\x5e\x29\135\x2b\51\134\x73\52\x5c\51\x28\133\x5e\73\x7d\54\134\x73\135\x2a\51\57\151"; public function __construct() { goto vz08c; p3wVB: DhzPF: goto JA0jm; vz08c: if (!$this->loadConstant()) { goto DhzPF; } goto kTJrj; kTJrj: parent::__construct(); goto p3wVB; JA0jm: } public function addFilters() : self { $this->addFilter("\x6f\160\164\x69\x6d\x69\172\141\x74\x69\157\156\x5f\142\x75\146\146\145\x72\x5f\x70\162\x6f\143\145\x73\163", [$this, "\x6d\141\171\x62\x65\111\156\151\x74\x50\x72\157\x63\x65\163\163"]); return parent::addFilters(); } public function loadConstant() { goto AudNW; gZQdr: goto VAuOX; goto jkIPP; jkIPP: rblag: goto K6QqN; K6QqN: define("\117\120\x54\x49\115\x49\132\x41\124\111\117\116\x5f\x43\x4f\x4d\x42\x49\116\105\x5f\120\101\x54\110", "{$GuTuU}\x2f\143\157\x6d\x62"); goto BDFJi; J9zd1: Notice::warning(sprintf(__("\45\163\40\143\157\x6e\x73\x74\141\x6e\164\x20\x6e\x6f\164\x20\x64\x65\x66\x69\156\x65\x64\54\40\x70\154\145\x61\x73\145\x20\144\x65\x66\151\156\x65\40\x74\x68\141\164\40\x69\x6e\40\167\x70\x2d\x63\x6f\x6e\146\x69\x67\x2e\x70\150\160\56", OPTIMIZATION_DOMAIN), "\74\143\x6f\x64\x65\76\127\120\x5f\x43\x41\103\110\105\x5f\x50\101\x54\110\x3c\57\143\x6f\x64\145\76")); goto gZQdr; AudNW: $pHq9s = false; goto RAXt0; RAXt0: if ($GuTuU = Util::getConstant("\127\120\x5f\103\x41\x43\x48\105\137\120\101\124\x48")) { goto rblag; } goto J9zd1; BDFJi: $pHq9s = $this->getFilesystem()->mkdir(OPTIMIZATION_COMBINE_PATH); goto LEnRN; rRjlB: return $pHq9s; goto A2Gnt; LEnRN: VAuOX: goto rRjlB; A2Gnt: } public function rewriteAssets($B6fu9, $iSNOk) { goto vGPZC; iEy53: foreach ($upoja[1] as $Lu_9j) { goto pT8ql; Wit0u: $A41gN = realpath("{$aOJ92}{$hgTz4}"); goto fC_K1; EhBkP: yWwD0: goto NmGzW; VBxPu: $IRToU[$Lu_9j] = "\x2f\x2f" . str_replace($tQVlb, $SZK3T, $A41gN); goto EhBkP; NmGzW: mK45m: goto JnGLf; fC_K1: if (!$A41gN) { goto yWwD0; } goto VBxPu; pT8ql: $hgTz4 = trim($Lu_9j, "\x20\11\xa\15\0\13\42\x27"); goto Wit0u; JnGLf: } goto Itj4u; jWFSL: $IRToU = []; goto QbLv7; tBgMK: LWN63: goto v6nf4; aikPM: if (!($tQVlb && $iSNOk)) { goto LWN63; } goto En9Hm; p6DoJ: if (!(is_array($upoja) && $upoja)) { goto grg80; } goto iEy53; r2Npu: $B6fu9 = $this->replaceAssets($B6fu9, $IRToU); goto tBgMK; Itj4u: mCpal: goto yLlE_; vGPZC: $tQVlb = untrailingslashit(CommonUtil::getConstant("\x41\x42\x53\x50\x41\x54\x48")); goto fcu65; v6nf4: return $B6fu9; goto du0tp; fcu65: $Gmm3u = site_url(); goto aikPM; En9Hm: $aOJ92 = $tQVlb . trailingslashit(dirname(str_replace($Gmm3u, '', $iSNOk))); goto jWFSL; QbLv7: $SZK3T = ArrayUtil::get(wp_parse_url($Gmm3u), "\x68\157\163\164"); goto eO1hj; eO1hj: preg_match_all(self::ASSETS_REGEX, $B6fu9, $upoja); goto p6DoJ; yLlE_: grg80: goto r2Npu; du0tp: } public function replaceAssets($B6fu9, $VWdyW = array()) { goto GKn9Y; h1Bta: array_multisort($zfbty, SORT_DESC, $VWdyW); goto qH9mI; y_CSP: return $B6fu9; goto Hhc0z; z5jwH: ahhwQ: goto y_CSP; GKn9Y: if (!$VWdyW) { goto ahhwQ; } goto svg11; qH9mI: $B6fu9 = str_replace(array_keys($VWdyW), array_values($VWdyW), $B6fu9); goto z5jwH; svg11: $zfbty = array_map("\163\x74\162\x6c\x65\156", array_keys($VWdyW)); goto h1Bta; Hhc0z: } public function maybeInitProcess($vwY7Y) { $vwY7Y = $this->combineFiles($vwY7Y, "\x6c\x69\x6e\153\133\x68\162\145\x66\x5d\133\x72\x65\x6c\75\163\x74\x79\x6c\x65\163\150\x65\x65\x74\135", "\154\x69\156\x6b", "\x68\162\x65\146"); return $vwY7Y; } public function combineSources($X7olV) { goto IEHNH; kDM9p: BHA09: goto gGaT5; gGaT5: return $kZx0K; goto UI1eN; IEHNH: $kZx0K = []; goto ut1p_; ut1p_: $yb0zb = $this->getFilesystem(); goto cKZlK; cKZlK: foreach ($X7olV as $o9yCo) { goto cmsY6; e2smK: $kZx0K = array_merge($this->combineSources($o9yCo->getDependencies()), $kZx0K); goto ZUgch; ZUgch: kIZpw: goto jVxd1; KjWZx: if (!$B6fu9) { goto Cgj7H; } goto N13Zr; oUiox: $kZx0K[$o9yCo->getHandle()] = $B6fu9; goto H6zfs; WIGlE: QueNc: goto MUfl9; N13Zr: $B6fu9 = $this->rewriteAssets($B6fu9, $o9yCo->getUrl()); goto J3ZZG; qS7iH: $B6fu9 = $yb0zb->getContent($GuTuU); goto KjWZx; J3ZZG: $o9yCo->setCombined(true); goto oUiox; H6zfs: if (!$o9yCo->getDependencies()) { goto kIZpw; } goto e2smK; GyNqQ: XiWY2: goto WIGlE; cmsY6: if (!$o9yCo instanceof Source) { goto XiWY2; } goto gtHgX; jVxd1: Cgj7H: goto GyNqQ; gtHgX: $GuTuU = $o9yCo->getPath(); goto qS7iH; MUfl9: } goto kDM9p; UI1eN: } public function isCombined($D2KXr) : bool { return $this->getFilesystem()->exists($D2KXr); } public function getFilePath($EOJKs, $jDNPs) : string { $GuTuU = CommonUtil::getConstant("\x4f\x50\x54\x49\115\x49\x5a\101\124\x49\x4f\116\x5f\x43\117\115\102\111\x4e\105\x5f\120\101\x54\x48"); return "{$GuTuU}\x2f{$jDNPs}\57{$EOJKs}\x2e{$jDNPs}"; } public function combineFiles($vwY7Y, $C2Sin, $uL8fN, $M6cdG) { goto fW7xB; y94QI: if ($this->isCombined($D2KXr)) { goto HsafQ; } goto GmaV0; nsRB9: $kZx0K = $this->applyFilters("\x6f\x70\164\x69\155\151\x7a\x61\164\151\157\156\x5f\x6d\x69\x6e\x69\x66\171\x5f{$jDNPs}", implode('', $kZx0K), $D2KXr); goto QnJ2S; lufhj: $D2KXr = $this->getFilePath($EOJKs, $jDNPs); goto d9RW5; d9RW5: $H4FTE = true; goto y94QI; qy2_9: $EOJKs = md5(implode('', array_keys($X7olV))); goto lufhj; ZZyL8: Hevyz: goto Vg0Ns; SWLgq: $Lh3fh["\141\163\171\x6e\143"] = true; goto pc3Fj; pc3Fj: $Lh3fh["\144\145\x66\x66\145\x72"] = true; goto MeQ2k; uLCgG: $Lh3fh = ["\x69\x64" => "\x63\x6f\155\x62\x69\156\145\x64\55{$jDNPs}", $M6cdG => str_replace(CommonUtil::getConstant("\101\x42\x53\120\101\x54\110"), trailingslashit(site_url()), $D2KXr)]; goto BCwgC; XLnrG: $vwY7Y = DOMCrawler::elementsMap($vwY7Y, $C2Sin, function (DOMElement $oMvxH) use(&$X7olV, $M6cdG) { goto WrpXA; OcRyE: return $oMvxH; goto GAWtl; OH2mI: if (!$RuYo3) { goto kM3R3; } goto MLQ00; rp32F: $RuYo3 = $this->getSourcePath($o9yCo); goto OH2mI; MLQ00: $GuTuU = str_replace($RuYo3["\x70\141\x74\x68\x5f\x75\x72\x6c"], $RuYo3["\160\141\x74\150"], $o9yCo); goto mDhGl; mDhGl: $X7olV[basename($GuTuU)] = (new Source())->setUrl($o9yCo)->setPath($GuTuU)->setType($oMvxH->nodeName)->setHandle($oMvxH->getAttribute("\151\144")); goto DEKzz; DEKzz: $oMvxH->parentNode->removeChild($oMvxH); goto nS_P6; WrpXA: $o9yCo = remove_query_arg("\166\145\162", $oMvxH->getAttribute($M6cdG)); goto rp32F; nS_P6: kM3R3: goto OcRyE; GAWtl: }); goto lS8TG; lS8TG: $jDNPs = $uL8fN == "\x6c\151\x6e\153" ? "\143\163\x73" : "\x6a\163"; goto qy2_9; MeQ2k: goto M9360; goto FSeVL; Zr8zW: $H4FTE = ThemeUtil::generateElement($uL8fN, $Lh3fh); goto r6jp1; FSeVL: L2ZMF: goto B6vZm; KzXTu: if (!$H4FTE) { goto gNu9W; } goto uLCgG; ZrtK1: return $vwY7Y; goto E2_rO; fW7xB: $X7olV = []; goto XLnrG; OtmIU: if (!$kZx0K) { goto Hevyz; } goto nsRB9; KAbeL: gNu9W: goto ZrtK1; QnJ2S: $H4FTE = $this->getFilesystem()->putContent($D2KXr, $kZx0K); goto ZZyL8; GmaV0: $kZx0K = $this->combineSources($X7olV); goto OtmIU; Y1SNg: M9360: goto Zr8zW; BCwgC: if ($jDNPs == "\143\163\163") { goto L2ZMF; } goto SWLgq; r6jp1: $vwY7Y = StringUtil::replaceFirst("\x3c\57\150\145\x61\x64\x3e", "{$H4FTE}\x3c\57\x68\x65\141\144\76", $vwY7Y); goto KAbeL; Vg0Ns: HsafQ: goto KzXTu; B6vZm: $Lh3fh["\162\x65\x6c"] = "\163\x74\x79\x6c\145\163\x68\145\x65\x74"; goto Y1SNg; E2_rO: } }
